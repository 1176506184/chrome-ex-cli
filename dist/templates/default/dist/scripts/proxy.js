var p=["load","loadend","timeout","error","readystatechange","abort"],y="__origin_xhr";function O(e,t){var s={};for(var u in e)s[u]=e[u];return s.target=s.currentTarget=t,s}function j(e,t){t=t||window;var s=t.XMLHttpRequest,u=!0,d=function(){for(var i=new s,a=0;a<p.length;++a){var v="on"+p[a];i[v]===void 0&&(i[v]=null)}for(var c in i){var n="";try{n=typeof i[c]}catch{}n==="function"?this[c]=T(c):c!==y&&Object.defineProperty(this,c,{get:g(c),set:b(c),enumerable:!0})}var o=this;i.getProxy=function(){return o},this[y]=i};d.prototype=s.prototype,d.prototype.constructor=d,t.XMLHttpRequest=d,Object.assign(t.XMLHttpRequest,{UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4});function g(i){return function(){var a=this[y][i];if(u){var v=this.hasOwnProperty(i+"_")?this[i+"_"]:a,c=(e[i]||{}).getter;return c&&c(v,this)||v}else return a}}function b(i){return function(a){var v=this[y];if(u){var c=this,n=e[i];if(i.substring(0,2)==="on")c[i+"_"]=a,v[i]=function(r){r=O(r,c);var f=e[i]&&e[i].call(c,v,r);f||a.call(c,r)};else{var o=(n||{}).setter;a=o&&o(a,c)||a,this[i+"_"]=a;try{v[i]=a}catch{}}}else v[i]=a}}function T(i){return function(){var a=[].slice.call(arguments);if(e[i]&&u){var v=e[i].call(this,a,this[y]);if(v)return v}return this[y][i].apply(this[y],a)}}function R(){u=!1,t.XMLHttpRequest===d&&(t.XMLHttpRequest=s,d.prototype.constructor=s,s=void 0)}return{originXhr:s,unHook:R}}var x=p[0],C=p[1],P=p[2],A=p[3],w=p[4],M=p[5],H="prototype";function N(e,t){return t=t||window,I(e,t)}function k(e){return e.replace(/^\s+|\s+$/g,"")}function X(e){return e.watcher||(e.watcher=document.createElement("a"))}function E(e,t){var s=e.getProxy(),u="on"+t+"_",d=O({type:t},s);s[u]&&s[u](d);var g;typeof Event=="function"?g=new Event(t,{bubbles:!1}):(g=document.createEvent("Event"),g.initEvent(t,!1,!0)),X(e).dispatchEvent(g)}function L(e){this.xhr=e,this.xhrProxy=e.getProxy()}L[H]=Object.create({resolve:function(t){var s=this.xhrProxy,u=this.xhr;s.readyState=4,u.resHeader=t.headers,s.response=s.responseText=t.response,s.statusText=t.statusText,s.status=t.status,E(u,w),E(u,x),E(u,C)},reject:function(t){this.xhrProxy.status=0,E(this.xhr,t.type),E(this.xhr,C)}});function _(e){function t(s){L.call(this,s)}return t[H]=Object.create(L[H]),t[H].next=e,t}var D=_(function(e){var t=this.xhr;e=e||t.config,t.withCredentials=e.withCredentials,t.open(e.method,e.url,e.async!==!1,e.user,e.password);for(var s in e.headers)t.setRequestHeader(s,e.headers[s]);t.send(e.body)}),S=_(function(e){this.resolve(e)}),F=_(function(e){this.reject(e)});function I(e,t){var s=e.onRequest,u=e.onResponse,d=e.onError;function g(n){var o=n.responseType;if(!o||o==="text")return n.responseText;var r=n.response;if(o==="json"&&!r)try{return JSON.parse(n.responseText)}catch(f){console.warn(f)}return r}function b(n,o){var r=new S(n),f={response:g(o),status:o.status,statusText:o.statusText,config:n.config,headers:n.resHeader||n.getAllResponseHeaders().split(`\r
`).reduce(function(l,h){if(h==="")return l;var m=h.split(":");return l[m.shift()]=k(m.join(":")),l},{})};if(!u)return r.resolve(f);u(f,r)}function T(n,o,r,f){var l=new F(n);r={config:n.config,error:r,type:f},d?d(r,l):l.next(r)}function R(){return!0}function i(n){return function(o,r){return T(o,this,r,n),!0}}function a(n,o){return n.readyState===4&&n.status!==0?b(n,o):n.readyState!==4&&E(n,w),!0}var{originXhr:v,unHook:c}=j({onload:R,onloadend:R,onerror:i(A),ontimeout:i(P),onabort:i(M),onreadystatechange:function(n){return a(n,this)},open:function(o,r){var f=this,l=r.config={headers:{}};l.method=o[0],l.url=o[1],l.async=o[2],l.user=o[3],l.password=o[4],l.xhr=r;var h="on"+w;if(r[h]||(r[h]=function(){return a(r,f)}),s)return!0},send:function(n,o){var r=o.config;if(r.withCredentials=o.withCredentials,r.body=n[0],s){var f=function(){s(r,new D(o))};return r.async===!1?f():setTimeout(f),!0}},setRequestHeader:function(n,o){if(o.config.headers[n[0].toLowerCase()]=n[1],s)return!0},addEventListener:function(n,o){var r=this;if(p.indexOf(n[0])!==-1){var f=n[1];return X(o).addEventListener(n[0],function(l){var h=O(l,r);h.type=n[0],h.isTrusted=!0,f.call(r,h)}),!0}},getAllResponseHeaders:function(n,o){var r=o.resHeader;if(r){var f="";for(var l in r)f+=l+": "+r[l]+`\r
`;return f}},getResponseHeader:function(n,o){var r=o.resHeader;if(r)return r[(n[0]||"").toLowerCase()]}},t);return{originXhr:v,unProxy:c}}N({onRequest:(e,t)=>{t.next(e)},onResponse:(e,t)=>{window.postMessage({type:"AJAX_MONITOR",direction:"response",url:e.config.url,data:e.response},"*"),t.next(e)}});
